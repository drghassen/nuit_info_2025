{% extends 'iot/base.html' %}
{% load static %}

{% block title %}EcoTrack • Scores Éco{% endblock %}

{% block content %}
<div class="text-center mb-5">
    <h1 class="display-5 fw-bold mb-3">Scores <span class="text-primary">Écologiques</span></h1>
    <p class="lead opacity-80">Analyse des scores éco, obsolescence, dépendance et économies CO₂</p>
</div>

<div class="row g-4 mb-4">
    <div class="col-lg-3 col-md-6">
        <div class="glass-card p-4 text-center">
            <i class="fas fa-leaf fa-2x text-success mb-3"></i>
            <p class="mb-1 opacity-75">Score Éco Moyen</p>
            <h3 class="metric-big text-success" id="avg-eco">-</h3>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="glass-card p-4 text-center">
            <i class="fas fa-clock fa-2x text-warning mb-3"></i>
            <p class="mb-1 opacity-75">Obsolescence Moyenne</p>
            <h3 class="metric-big text-warning" id="avg-obsolescence">-</h3>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="glass-card p-4 text-center">
            <i class="fas fa-building fa-2x text-danger mb-3"></i>
            <p class="mb-1 opacity-75">Dépendance BigTech</p>
            <h3 class="metric-big text-danger" id="avg-bigtech">-</h3>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="glass-card p-4 text-center">
            <i class="fas fa-seedling fa-2x text-success mb-3"></i>
            <p class="mb-1 opacity-75">Économies CO₂</p>
            <h3 class="metric-big text-success" id="avg-co2-savings">-</h3>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-lg-6">
        <div class="chart-container glass-card">
            <h5 class="mb-3"><i class="fas fa-leaf me-2 text-success"></i>Score Écologique</h5>
            <canvas id="ecoChart"></canvas>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="chart-container glass-card">
            <h5 class="mb-3"><i class="fas fa-clock me-2 text-warning"></i>Score d'Obsolescence</h5>
            <canvas id="obsolescenceChart"></canvas>
        </div>
    </div>
</div>
<div class="row g-4 mb-5">
    <div class="col-lg-6">
        <div class="chart-container glass-card">
            <h5 class="mb-3"><i class="fas fa-building me-2 text-danger"></i>Dépendance BigTech</h5>
            <canvas id="bigtechChart"></canvas>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="chart-container glass-card">
            <h5 class="mb-3"><i class="fas fa-seedling me-2 text-success"></i>Économies CO₂ (kg/an)</h5>
            <canvas id="co2SavingsChart"></canvas>
        </div>
    </div>
</div>

<div class="glass-card overflow-hidden">
    <div class="p-4 border-bottom border-white border-opacity-10">
        <h4 class="mb-0"><i class="fas fa-table me-2 text-primary"></i>Dernières Données de Scores</h4>
    </div>
    <div class="table-responsive">
        <table class="table table-custom table-hover mb-0">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Sensor ID</th>
                    <th>Score Éco</th>
                    <th>Obsolescence</th>
                    <th>BigTech</th>
                    <th>Économies CO₂</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="data-table-body">
                {% for data in latest_data %}
                <tr>
                    <td>{{ data.id }}</td>
                    <td>{{ data.hardware_sensor_id }}</td>
                    <td><span class="badge {% if data.eco_score >= 75 %}bg-success{% elif data.eco_score >= 50 %}bg-warning{% else %}bg-danger{% endif %}">{{ data.eco_score }}</span></td>
                    <td>{{ data.obsolescence_score }}</td>
                    <td>{{ data.bigtech_dependency }}</td>
                    <td>{{ data.co2_savings_kg_year }} kg/an</td>
                    <td>{{ data.created_at|date:"d/m/Y H:i" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="text-center py-5 opacity-50">Aucune donnée disponible</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Données pour JavaScript (cachées) -->
<script type="application/json" id="chart-labels-data">{{ chart_labels|safe }}</script>
<script type="application/json" id="eco-data">{{ eco_data|safe }}</script>
<script type="application/json" id="obsolescence-data">{{ obsolescence_data|safe }}</script>
<script type="application/json" id="bigtech-data">{{ bigtech_data|safe }}</script>
<script type="application/json" id="co2-savings-data">{{ co2_savings_data|safe }}</script>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/scores.js' %}"></script>
{% endblock %}
