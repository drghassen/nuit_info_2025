{% extends 'iot/base.html' %}
{% load static %}

{% block title %}EcoTrack • Réseau{% endblock %}

{% block content %}
<div class="text-center mb-5">
    <h1 class="display-5 fw-bold mb-3">Données <span class="text-info">Réseau</span></h1>
    <p class="lead opacity-80">Charge réseau, requêtes et dépendance au cloud</p>
</div>

<div class="row g-4 mb-4">
    <div class="col-lg-4 col-md-6">
        <div class="glass-card p-4 text-center">
            <i class="fas fa-chart-line fa-2x text-primary mb-3"></i>
            <p class="mb-1 opacity-75">Charge Réseau Moyenne</p>
            <h3 class="metric-big text-primary" id="avg-network-load">-</h3>
        </div>
    </div>
    <div class="col-lg-4 col-md-6">
        <div class="glass-card p-4 text-center">
            <i class="fas fa-exchange-alt fa-2x text-warning mb-3"></i>
            <p class="mb-1 opacity-75">Requêtes/min</p>
            <h3 class="metric-big text-warning" id="avg-requests">-</h3>
        </div>
    </div>
    <div class="col-lg-4 col-md-6">
        <div class="glass-card p-4 text-center">
            <i class="fas fa-cloud fa-2x text-danger mb-3"></i>
            <p class="mb-1 opacity-75">Dépendance Cloud</p>
            <h3 class="metric-big text-danger" id="avg-cloud">-</h3>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-lg-6">
        <div class="chart-container glass-card">
            <h5 class="mb-3"><i class="fas fa-chart-line me-2 text-primary"></i>Charge Réseau (Mbps)</h5>
            <canvas id="networkLoadChart"></canvas>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="chart-container glass-card">
            <h5 class="mb-3"><i class="fas fa-exchange-alt me-2 text-warning"></i>Requêtes par Minute</h5>
            <canvas id="requestsChart"></canvas>
        </div>
    </div>
</div>
<div class="row g-4 mb-5">
    <div class="col-lg-12">
        <div class="chart-container glass-card">
            <h5 class="mb-3"><i class="fas fa-cloud me-2 text-danger"></i>Score de Dépendance Cloud</h5>
            <canvas id="cloudDependencyChart"></canvas>
        </div>
    </div>
</div>

<div class="glass-card overflow-hidden">
    <div class="p-4 border-bottom border-white border-opacity-10">
        <h4 class="mb-0"><i class="fas fa-table me-2 text-primary"></i>Dernières Données Réseau</h4>
    </div>
    <div class="table-responsive">
        <table class="table table-custom table-hover mb-0">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Sensor ID</th>
                    <th>Charge Réseau (Mbps)</th>
                    <th>Requêtes/min</th>
                    <th>Dépendance Cloud</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="data-table-body">
                {% for data in latest_data %}
                <tr>
                    <td>{{ data.id }}</td>
                    <td>{{ data.network_sensor_id }}</td>
                    <td>{{ data.network_load_mbps }} Mbps</td>
                    <td>{{ data.requests_per_min }}</td>
                    <td><span class="badge {% if data.cloud_dependency_score > 80 %}bg-danger{% elif data.cloud_dependency_score > 50 %}bg-warning{% else %}bg-success{% endif %}">{{ data.cloud_dependency_score }}%</span></td>
                    <td>{{ data.created_at|date:"d/m/Y H:i" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center py-5 opacity-50">Aucune donnée disponible</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Données pour JavaScript (cachées) -->
<script type="application/json" id="chart-labels-data">{{ chart_labels|safe }}</script>
<script type="application/json" id="network-load-data">{{ network_load_data|safe }}</script>
<script type="application/json" id="requests-data">{{ requests_data|safe }}</script>
<script type="application/json" id="cloud-dependency-data">{{ cloud_dependency_data|safe }}</script>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/network.js' %}"></script>
{% endblock %}
