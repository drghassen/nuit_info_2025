{% extends 'iot/base.html' %}
{% load static %}

{% block title %}EcoTrack • Matériel{% endblock %}

{% block content %}
<div class="text-center mb-5">
    <h1 class="display-5 fw-bold mb-3">Données <span class="text-primary">Matérielles</span></h1>
    <p class="lead opacity-80">CPU, RAM, batterie et âge des appareils</p>
</div>

<div class="row g-4 mb-4">
    <div class="col-lg-3 col-md-6">
        <div class="glass-card p-4 text-center">
            <i class="fas fa-microchip fa-2x text-primary mb-3"></i>
            <p class="mb-1 opacity-75">CPU Moyen</p>
            <h3 class="metric-big text-primary" id="avg-cpu">-</h3>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="glass-card p-4 text-center">
            <i class="fas fa-memory fa-2x text-info mb-3"></i>
            <p class="mb-1 opacity-75">RAM Moyenne</p>
            <h3 class="metric-big text-info" id="avg-ram">-</h3>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="glass-card p-4 text-center">
            <i class="fas fa-battery-half fa-2x text-success mb-3"></i>
            <p class="mb-1 opacity-75">Batterie Moyenne</p>
            <h3 class="metric-big text-success" id="avg-battery">-</h3>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="glass-card p-4 text-center">
            <i class="fas fa-calendar-alt fa-2x text-warning mb-3"></i>
            <p class="mb-1 opacity-75">Âge Moyen</p>
            <h3 class="metric-big text-warning" id="avg-age">-</h3>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-lg-6">
        <div class="chart-container glass-card">
            <h5 class="mb-3"><i class="fas fa-chart-line me-2 text-primary"></i>Utilisation CPU & RAM</h5>
            <canvas id="cpuRamChart"></canvas>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="chart-container glass-card">
            <h5 class="mb-3"><i class="fas fa-battery-half me-2 text-success"></i>Santé de la Batterie</h5>
            <canvas id="batteryChart"></canvas>
        </div>
    </div>
</div>
<div class="row g-4 mb-5">
    <div class="col-lg-12">
        <div class="chart-container glass-card">
            <h5 class="mb-3"><i class="fas fa-calendar-alt me-2 text-warning"></i>Âge des Appareils (années)</h5>
            <canvas id="ageChart"></canvas>
        </div>
    </div>
</div>

<div class="glass-card overflow-hidden">
    <div class="p-4 border-bottom border-white border-opacity-10">
        <h4 class="mb-0"><i class="fas fa-table me-2 text-primary"></i>Dernières Données Matérielles</h4>
    </div>
    <div class="table-responsive">
        <table class="table table-custom table-hover mb-0">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Sensor ID</th>
                    <th>CPU (%)</th>
                    <th>RAM (%)</th>
                    <th>Batterie (%)</th>
                    <th>Âge (ans)</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="data-table-body">
                {% for data in latest_data %}
                <tr>
                    <td>{{ data.id }}</td>
                    <td>{{ data.hardware_sensor_id }}</td>
                    <td>{{ data.cpu_usage }}%</td>
                    <td>{{ data.ram_usage }}%</td>
                    <td><span class="badge {% if data.battery_health >= 80 %}bg-success{% elif data.battery_health >= 50 %}bg-warning{% else %}bg-danger{% endif %}">{{ data.battery_health }}%</span></td>
                    <td>{{ data.age_years }} ans</td>
                    <td>{{ data.created_at|date:"d/m/Y H:i" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="text-center py-5 opacity-50">Aucune donnée disponible</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Données pour JavaScript (cachées) -->
<script type="application/json" id="chart-labels-data">{{ chart_labels|safe }}</script>
<script type="application/json" id="cpu-data">{{ cpu_data|safe }}</script>
<script type="application/json" id="ram-data">{{ ram_data|safe }}</script>
<script type="application/json" id="battery-data">{{ battery_data|safe }}</script>
<script type="application/json" id="age-data">{{ age_data|safe }}</script>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/hardware.js' %}"></script>
{% endblock %}
